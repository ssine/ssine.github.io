<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="zh-cn"><meta name=author content="Sine"><meta name=description content="来自计算机组成原理课程设计的项目。 介绍 为什么要做它 计算机组成原理的实验课要用高级语言写一个 Virtual Machine ，第一步是先交设计报告，这几天就一直在思前想后"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="CHIP-8 模拟器"><meta name=twitter:description content="来自计算机组成原理课程设计的项目。 介绍 为什么要做它 计算机组成原理的实验课要用高级语言写一个 Virtual Machine ，第一步是先交设计报告，这几天就一直在思前想后"><meta property="og:title" content="CHIP-8 模拟器"><meta property="og:description" content="来自计算机组成原理课程设计的项目。 介绍 为什么要做它 计算机组成原理的实验课要用高级语言写一个 Virtual Machine ，第一步是先交设计报告，这几天就一直在思前想后"><meta property="og:type" content="article"><meta property="og:url" content="https://ssine.ink/posts/chip8-emulator/"><meta property="article:published_time" content="2018-03-16T00:00:00+00:00"><meta property="article:modified_time" content="2018-03-16T00:00:00+00:00"><title>CHIP-8 模拟器 · Sine's Site</title><link rel=canonical href=https://ssine.ink/posts/chip8-emulator/><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=preload href="https://ssine.ink/fonts/forkawesome-webfont.woff2?v=1.1.7" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://ssine.ink/css/coder.min.a050bb9724f6a498b574acf612d6d523bc68756ddc62579923710a8542947c52.css integrity="sha256-oFC7lyT2pJi1dKz2EtbVI7xodW3cYleZI3EKhUKUfFI=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://ssine.ink/css/coder-dark.min.126ad3988d46bdae6217a11105b53c9662bca05f39d42d3c0fb366919d334620.css integrity="sha256-EmrTmI1Gva5iF6ERBbU8lmK8oF851C08D7NmkZ0zRiA=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://ssine.ink/favicon.ico sizes=32x32><link rel=icon type=image/png href=https://ssine.ink/favicon.ico sizes=16x16><link rel=apple-touch-icon href=https://ssine.ink/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://ssine.ink/images/apple-touch-icon.png><meta name=generator content="Hugo 0.74.1"></head><body class=colorscheme-auto><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://ssine.ink/>Sine's Site</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://ssine.ink/posts/>博客</a></li><li class=navigation-item><a class=navigation-link href=https://kiwi.ssine.cc>维基</a></li><li class=navigation-item><a class=navigation-link href=https://ssine.ink/gallery>画廊</a></li><li class=navigation-item><a class=navigation-link href=https://ssine.ink/projects/>项目</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=https://ssine.ink/en/posts/chip8-emulator/>English</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>CHIP-8 模拟器</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i><time datetime=2018-03-16T00:00:00Z>March 16, 2018</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>阅读时间：3 分钟</span></div></div></header><div><p>来自计算机组成原理课程设计的项目。</p><h1 id=介绍>介绍</h1><h2 id=为什么要做它>为什么要做它</h2><p>计算机组成原理的实验课要用高级语言写一个 Virtual Machine ，第一步是先交设计报告，这几天就一直在思前想后要做什么样的 VM 。 软件重制上学期的 Proteus CPU 的话实在太寒碜，想写个 Y86 仿真工程量又太大。 今天上课的时候看到朋友在查 NES 模拟器，受到启发，做一个游戏机模拟器的话多有意思，还能运行游戏成就感满满啊。 原本就对早期的游戏很感兴趣，上世纪中旬电子游戏刚兴起的时候，那些游戏都是鼻祖呢。 之后便开始搜集资料了，根据历史，最早的游戏是在实验室的示波器上玩的，之后是在 PDP-1 机器上，再之后出现了第一台街机。 然而这些机器关注度不高，开发文档也比较少。 之后比较热门的是 NES 游戏机（日本的 FC ）。 还有一个我比较感兴趣的 Gameboy。 深入了解之后发现要实现它们的工作量实在是有点大， 大约是个半年多的项目，拿来做二分之一的 Final Project 有些蠢萌。（Gameboy 系列有 Gameboy Color 和 Gameboy Advanced 两个升级版， GBA直接就 ARM7指令集了，虽然非常非常想做但那还是太不自量力了。） 在我抱着对巨大工作量的恐惧浏览 NES 相关资料的时候，发现了一个神奇的东西 —— Chip-8。</p><p>这是一个1970年提出的解释性编程语言（interpreted programming language），运行在专用的 <strong>CHIP-8 Virtual Machine</strong> 上， 为了帮助人们更方便的开发游戏。 Developer: Joseph Weisbecker. 当然，重点是， Chip-8 大约是我目前可以实现的最简单的实际存在的仿真项目了。 So just work on it, let&rsquo;s go.</p><h2 id=相关资源>相关资源</h2><p>英文教程 <a href=http://www.multigesture.net/articles/how-to-write-an-emulator-chip-8-interpreter/>How to write an emulator (CHIP-8 interpreter)</a></p><p>技术文档 <a href=http://devernay.free.fr/hacks/chip8/C8TECH10.HTM>Cowgod’s Chip-8 Technical Reference v1.0</a></p><p>游戏ROM合集包 <a href=https://www.zophar.net/pdroms/chip8/chip-8-games-pack.html>Chip-8 Games Pack</a></p><p>Github 项目 <a href=https://github.com/alexanderdickson/Chip-8-Emulator>Chip-8 Emulator</a></p><p>中文教程 <a href=http://blog.csdn.net/korekara88730/article/details/50987930>手把手教你编写游戏模拟器 - Chip8篇(1)</a></p><p>js聪明地绘图 <a href=https://www.paulirish.com/2011/requestanimationframe-for-smart-animating/>requestAnimationFrame for Smart Animating</a></p><p>一些游戏的说明 <a href=http://www.pong-story.com/chip8/>David Winter&rsquo;s CHIP-8 emulation page</a></p><p>Chip8 到 Super Chip8 <a href=http://devernay.free.fr/hacks/chip8/schip.txt>SUPER-CHIP v1.1</a></p><h1 id=机器概览>机器概览</h1><p>首先要找到关于 Chip-8 VM 的详细信息， 以下内容整理自<a href=https://en.wikipedia.org/wiki/CHIP-8#Virtual_machine_description>维基百科</a>。</p><h2 id=内存>内存</h2><p>CHIP-8 有 4K(<code>0x1000</code>) 内存， 8 位字长（chip 8 的由来）。 CHIP-8 解释器占据内存前 512 字节(<code>0x200</code>)， 最高的 256 字节(<code>0xF00-0xFFF</code>)为显示刷新预留，它下面的 96 字节(<code>0xEA0-0xEFF</code>)为堆栈、内部使用和其他变量保留。</p><p>在现在的实现中，解释器作为外部代码不需要再放在内存中运行， 但一般会在低 512 字节中存储字体数据。</p><h2 id=寄存器>寄存器</h2><p>CHIP-8 有 16 个 8 位寄存器， 从 <code>V0</code> 到 <code>VF</code>。 <code>VF</code> 寄存器作为一些指令的标志位， 应当避免使用。 （加法中进位标志， 减法中无借位标志，绘图中与像素碰撞有关）</p><p>地址寄存器的名字叫做 <code>I</code>， 有 16 位字长，与几个内存操作指令有关。</p><h2 id=堆栈>堆栈</h2><p>堆栈只在子程序被调用时存储返回地址。 现在的实现通常有最少 16 层。</p><h2 id=计时器>计时器</h2><p>CHIP-8 有两个计时器。 它们以 60 Hz 的速度 count down，直到 0 。</p><ul><li>延迟寄存器： 用于为游戏中的事件计时，它的值可以被设置和读取。</li><li>声音寄存器： 用于声音效果，如果它的值不是0，发出蜂鸣。</li></ul><h2 id=输入>输入</h2><p>输入设备是一个 0 到 F 的 hex keyboard 。 其中 <code>8462</code> 通常被用于方向输入。 有三条指令用于检测输入。 一个是当某个特定键被按下时跳过一条指令，另一个在没有按键时跳过一条指令。 第三个等待一个键盘输入， 并把它保存在一个寄存器里。</p><h2 id=图形与声音>图形与声音</h2><p>原生的 CHIP-8 显示分辨率为 64×32 像素， 单色。 图像通过向屏幕绘制宽 8 ，高 1 到 15 的 sprites 实现。 Sprite 像素与对应位置屏幕上的像素点异或， 因此是在反转屏幕对应位置的像素点。 在一个 sprit 被画出时，如果屏幕上有像素点从亮变暗， <code>VF</code> 寄存器就会被设置为 1 ，否则为 0 。 这被用于碰撞检测。</p><p>声音部分在声音寄存器中说过。</p><h2 id=操作码表>操作码表</h2><p>CHIP-8 有 35 个操作码，全部是 2字节长， 以大端法储存。 下面是列表，标志如下：</p><ul><li>NNN: 地址</li><li>NN: 8 位常数</li><li>N: 4 位常数</li><li>X and Y: 4 位寄存器标识符</li><li>PC : 程序计数器</li><li>I : 内存寻址用16位寄存器</li></ul><p>懒的翻译了……表格详见<a href=https://en.wikipedia.org/wiki/CHIP-8#Opcode_table>维基百科</a></p></div><footer></footer></article><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};</script></section></div><footer class=footer><section class=container><p>© 2016 - 2023 正弦 | <a href=https://beian.miit.gov.cn/ target=_blank>京ICP备19051756号</a></p></section></footer></main><script src=https://ssine.ink/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-127064931-1','auto');ga('send','pageview');}</script></body></html>