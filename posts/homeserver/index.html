<!doctype html><html lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="zh-cn"><meta name=author content="Sine"><meta name=description content="几个月前入手了 HPE MicroServer Gen 10 Plus ，从配置好到现在一直都在稳定运行，下面聊聊家庭服务器的相关配置和应用。 买一台主机放在家常年开机专门当做服务器使用，价"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="HPE MicroServer 的设置与应用"><meta name=twitter:description content="几个月前入手了 HPE MicroServer Gen 10 Plus ，从配置好到现在一直都在稳定运行，下面聊聊家庭服务器的相关配置和应用。 买一台主机放在家常年开机专门当做服务器使用，价"><meta property="og:title" content="HPE MicroServer 的设置与应用"><meta property="og:description" content="几个月前入手了 HPE MicroServer Gen 10 Plus ，从配置好到现在一直都在稳定运行，下面聊聊家庭服务器的相关配置和应用。 买一台主机放在家常年开机专门当做服务器使用，价"><meta property="og:type" content="article"><meta property="og:url" content="https://ssine.ink/posts/homeserver/"><meta property="article:published_time" content="2021-04-14T01:05:20+08:00"><meta property="article:modified_time" content="2021-04-14T01:05:20+08:00"><title>HPE MicroServer 的设置与应用 · Sine's Site</title><link rel=canonical href=https://ssine.ink/posts/homeserver/><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=preload href="https://ssine.ink/fonts/forkawesome-webfont.woff2?v=1.1.7" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://ssine.ink/css/coder.min.a050bb9724f6a498b574acf612d6d523bc68756ddc62579923710a8542947c52.css integrity="sha256-oFC7lyT2pJi1dKz2EtbVI7xodW3cYleZI3EKhUKUfFI=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://ssine.ink/css/coder-dark.min.126ad3988d46bdae6217a11105b53c9662bca05f39d42d3c0fb366919d334620.css integrity="sha256-EmrTmI1Gva5iF6ERBbU8lmK8oF851C08D7NmkZ0zRiA=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://ssine.ink/favicon.ico sizes=32x32><link rel=icon type=image/png href=https://ssine.ink/favicon.ico sizes=16x16><link rel=apple-touch-icon href=https://ssine.ink/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://ssine.ink/images/apple-touch-icon.png><meta name=generator content="Hugo 0.74.1"></head><body class=colorscheme-auto><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://ssine.ink/>Sine's Site</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://ssine.ink/posts/>博客</a></li><li class=navigation-item><a class=navigation-link href=https://kiwi.ssine.cc>维基</a></li><li class=navigation-item><a class=navigation-link href=https://ssine.ink/gallery>画廊</a></li><li class=navigation-item><a class=navigation-link href=https://ssine.ink/projects/>项目</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=https://ssine.ink/en/posts/homeserver/>English</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>HPE MicroServer 的设置与应用</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i><time datetime=2021-04-14T01:05:20+08:00>April 14, 2021</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>阅读时间：4 分钟</span></div></div></header><div><p>几个月前入手了 HPE MicroServer Gen 10 Plus ，从配置好到现在一直都在稳定运行，下面聊聊家庭服务器的相关配置和应用。 买一台主机放在家常年开机专门当做服务器使用，价格会比同配置的云服务器便宜很多，这是以平时的维护成本和家庭环境更低的稳定性为代价的，但是如果有居住条件和技术，这仍然是一个实惠且有趣的选择。 一个比较典型的场景是自建云盘，对硬盘的要求很高，但是硬盘容量大、带宽大、流量足的云主机通常很贵，这时使用家庭服务器就很方便，可以随时添加硬盘，内网也不会出现带宽和流量的瓶颈。</p><h1 id=装机>装机</h1><p>慧与官方只出售 MicroServer 本体和 iLO 扩展卡，还有一些东西 ( 主要是硬盘 ) 需要自己购买安装，下面是后续用到的一些物品的淘宝链接。</p><ul><li><a href="https://m.tb.cn/h.4KYHEL0?sm=ad1309">TOOLFREE 2.5 转 3.5 寸硬盘转接盒</a></li><li><a href="https://m.tb.cn/h.4ooR65C?sm=fd8d34">西数蓝盘 1T 2.5 英寸 SATA3 SSD</a></li><li><a href="https://m.tb.cn/h.4pgbuV8?sm=3b1128">绿联 PCIE 转 NVME 扩展卡</a></li><li><a href="https://m.tb.cn/h.4LkV8IU?sm=644fe9">西数 蓝盘 SN550 1TB</a></li><li><a href="https://m.tb.cn/h.4oo7xSg?sm=f735fd">展示盒透明塑料</a></li></ul><h2 id=硬件配置>硬件配置</h2><p>MicroServer 本身的配置：</p><ul><li>处理器 Intel Xeon E-2224 Quad-Core 3.4GHz 8MB CPU, Up To 4.6GHz Turbo</li><li>内存 16GB ( 2 x 8GB ) DDR4 PC4-21300 2666MHz Unbuffered Memory</li></ul><p>其它不细说了，内存是 ECC 内存会很稳定，有四个网口。</p><p>我个人对声音比较敏感，在家时电脑机械硬盘转动的声音就足以让我感到烦躁，因此对于要 24 小时运作的服务器来说，还是优先考虑 SSD。 机器本身有四个 3.5 寸 SATA 盘位，但是主板上没有自带的 NVME SSD 槽位，所以想要高速 SSD 只能从 PCIE 转接。 我打算装一个 1T SSD 做虚拟机的主要硬盘，另外四个盘位留给 NAS 系统使用，因此入手了 PCIE 转 NVME 扩展卡和一个 SSD 硬盘。 SATA 盘位也暂时入手了一个 2.5 寸 SATA SSD 和一个 2.5 转 3.5 转接盒，这样就能顺利把 SSD 放入 SATA 盘位了。</p><p>对于组件安装的细节可以查阅 MicroServer 用户手册： <a href=https://psnow.ext.hpe.com/doc/a00073430zh_cn>中文</a> <a href=https://psnow.ext.hpe.com/doc/a00073430en_us>英文</a> 。</p><h2 id=系统选择安装>系统选择安装</h2><p>像这种裸的服务器通常有两种选择，装一个虚拟化管理系统并在里面装虚拟机，或是直接把系统装在主机上。 前者的好处是方便管理很多虚拟机，可以做备份迁移等操作，坏处是虚拟化会有一些性能损失，查了下资料发现计算性能是几乎不受影响的，主要是虚拟硬盘带来的 IO 性能下降，基本在 10% 以内。 后者好处是操作比较熟悉，坏处是稳定性比起专用的服务器管理系统要差很多。</p><p>个人使用的话，服务器裸机的管理系统主要有 VMWare 的 ESXi 和开源的 Proxmox VE ，前者靠谱稳定，后者更像是 Linux + 特殊虚拟化支持。 由于 HPE MicroServer 官方有定制的 ESXi 镜像，可以保证驱动兼容性，所以为了方便就使用 ESXi 系统了。 ESXi 可以理解成一个只包含 VMWare Workstation 虚拟机管理软件的操作系统，当然还有一些操作系统的功能，比如文件管理。</p><p>至于系统安装还是需要 HDMI 或者 DP 接显示器，把镜像烧录到 U 盘，设置 BIOS 从 USB 启动，然后装机。</p><ul><li>镜像下载链接： <a href="https://my.vmware.com/cn/group/vmware/downloads/details?downloadGroup=OEM-ESXI70-HPE&productId=974">https://my.vmware.com/cn/group/vmware/downloads/details?downloadGroup=OEM-ESXI70-HPE&productId=974</a></li><li>官方免费长期有效 Lisense: <a href="https://my.vmware.com/en/group/vmware/evalcenter?p=free-esxi7">https://my.vmware.com/en/group/vmware/evalcenter?p=free-esxi7</a></li></ul><h2 id=ilo>iLO</h2><p>iLO 是一个远程控制用的扩展卡，ESXi 有两个 PCIE 槽位，我是一个转接了 SSD，另一个给 iLO. iLO 卡自带一个网口 ( 加上原本的四个就是五个了 ) ，是为了防止主机的网口被占满导致无法控制机器，如果带宽占用不高的话也可以把网线插在主机的网口上，iLO 可以和其它主机共享一个网口，IP 不同。</p><p>iLO 为远程控制主机提供了完整的方案，通过 Web 服务就能操控主机开关机，也可以通过 console 看到主机的显示输出。 iLO 的初始密码位于贴在服务器上的一个标签上，详情可以查阅 iLO 用户手册： <a href=https://psnow.ext.hpe.com/doc/a00048134zh_cn>中文</a> <a href="https://support.hpe.com/hpesc/public/docDisplay?docId=a00048134en_us">英文</a> 。</p><h1 id=应用>应用</h1><p>主机设置好之后，就可以安装虚拟机了，把想要的操作系统镜像上传到 ESXi，之后创建虚拟机。 存储空间按需分配，太大的虚拟机备份起来会比较麻烦。</p><h2 id=虚拟机配置>虚拟机配置</h2><p>ESXi 支持 Linux、Windows 等很多类虚拟机，虚拟机内部的配置就和本文无关了。 不过这里有一点要提一下，就是如何动态扩充虚拟机的磁盘空间。 虚拟机的磁盘都是 vmdk 格式的，在 ESXi 扩大 vmdk 大小之后，进入虚拟机 ( 这里是 Centos8，用 LVM 管理磁盘 ) ，运行 <code>fdisk</code> 可以看见显示大小不一致，输入 <code>w q</code> 可以修复。</p><p>之后创建一个新的主分区 ( GPT 支持 128 个而不是 4 个，随便创建 ) ，文件系统类型选择 Linux LVM 。</p><p>然后是 LVM 的事情 ( 参照 <a href=https://www.cnblogs.com/gaojun/archive/2012/08/22/2650229.html>这里</a> ) ，运行 <code>pvcreate /dev/sdax</code> 新加一个物理卷，之后 <code>vgdisplay</code> 查看所有的卷组，把新加的物理卷放到需要增加的卷组 <code>vgextend cl /dev/sdax</code> ，然后就能给卷组里面的逻辑卷扩容了： <code>lvdisplay</code> ， <code>lvextend -l +xxx cl-home</code> 。 最后把文件系统扩张到卷大小： <code>xfs_growfs /dev/mapper/cl-home</code>( 虚拟磁盘设备在 <code>fdisk -l</code> 这里找 ) 。</p><p>对于 NAS 服务有必要做硬盘直通，可以让虚拟机内部直接控制整块硬盘，包括温度等信息，也能让 HDD 在不用时休眠。 在 ESXi 里面创建直通的虚拟硬盘然后添加到对应的虚拟机就可以了。</p><h2 id=一些服务>一些服务</h2><p>至于要拿家庭服务器来干什么就因人而异了，简单列举下我目前在运行的服务：</p><ul><li>Jupyter Lab，参见 <a href=https://ssine.ink/posts/versatile-jupyter-lab/>打造有多个内核的 Jupyter Lab 容器</a></li><li>Matrix 聊天服务器 Synapse， 参见 <a href=https://ssine.ink/posts/matrix-bot-and-bridges/>自建聊天服务器、机器人与多平台桥接</a></li><li>RSS 相关：</li><li><a href=https://docs.rsshub.app/>RSSHub</a> ，用于提供 RSS 信息源</li><li><a href=https://tt-rss.org/>Tiny Tiny RSS</a> ，RSS Web 客户端，用于阅读</li><li>Mongodb，存储一些格式化的个人信息</li><li>Grafana，关注的信息看板</li><li>NextCloud，云盘，直通了 1T 外部 SSD 硬盘</li><li>Bitwarden，密码管理</li><li>Calibre，电子书管理，没怎么用，建议先养成看书习惯再搞</li></ul></div><footer></footer></article><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};</script></section></div><footer class=footer><section class=container><p>© 2016 - 2023 正弦 | <a href=https://beian.miit.gov.cn/ target=_blank>京ICP备19051756号</a></p></section></footer></main><script src=https://ssine.ink/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-127064931-1','auto');ga('send','pageview');}</script></body></html>