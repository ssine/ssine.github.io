<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=author content="Sine"><meta name=description content="A script written at any time for the convenience of taking notes and/or removing white background and uploading images to the OSS service.
When I recently wrote notes, I encountered the problem of putting the handwritten/screen content on the paper on the webpage. This is a manual solution: scan the Evernote document, save it to the computer, download it on the computer, PS Remove the white background, upload it to OSS, get the image link, and insert it into the note."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Automated Image Script"><meta name=twitter:description content="A script written at any time for the convenience of taking notes and/or removing white background and uploading images to the OSS service.
When I recently wrote notes, I encountered the problem of putting the handwritten/screen content on the paper on the webpage. This is a manual solution: scan the Evernote document, save it to the computer, download it on the computer, PS Remove the white background, upload it to OSS, get the image link, and insert it into the note."><meta property="og:title" content="Automated Image Script"><meta property="og:description" content="A script written at any time for the convenience of taking notes and/or removing white background and uploading images to the OSS service.
When I recently wrote notes, I encountered the problem of putting the handwritten/screen content on the paper on the webpage. This is a manual solution: scan the Evernote document, save it to the computer, download it on the computer, PS Remove the white background, upload it to OSS, get the image link, and insert it into the note."><meta property="og:type" content="article"><meta property="og:url" content="https://ssine.ink/en/posts/auto-image-script/"><meta property="article:published_time" content="2018-04-26T00:00:00+00:00"><meta property="article:modified_time" content="2018-04-26T00:00:00+00:00"><title>Automated Image Script · Sine's Site</title><link rel=canonical href=https://ssine.ink/en/posts/auto-image-script/><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=preload href="https://ssine.ink/fonts/forkawesome-webfont.woff2?v=1.1.7" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://ssine.ink/css/coder.min.a050bb9724f6a498b574acf612d6d523bc68756ddc62579923710a8542947c52.css integrity="sha256-oFC7lyT2pJi1dKz2EtbVI7xodW3cYleZI3EKhUKUfFI=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://ssine.ink/css/coder-dark.min.126ad3988d46bdae6217a11105b53c9662bca05f39d42d3c0fb366919d334620.css integrity="sha256-EmrTmI1Gva5iF6ERBbU8lmK8oF851C08D7NmkZ0zRiA=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://ssine.ink/favicon.ico sizes=32x32><link rel=icon type=image/png href=https://ssine.ink/favicon.ico sizes=16x16><link rel=apple-touch-icon href=https://ssine.ink/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://ssine.ink/images/apple-touch-icon.png><meta name=generator content="Hugo 0.74.1"></head><body class=colorscheme-auto><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://ssine.ink/en>Sine's Site</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://ssine.ink/en/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://kiwi.ssine.cc>Wiki</a></li><li class=navigation-item><a class=navigation-link href=https://ssine.ink/en/gallery>Gallery</a></li><li class=navigation-item><a class=navigation-link href=https://ssine.ink/en/projects/>Projects</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=https://ssine.ink/posts/auto-image-script/>中文</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Automated Image Script</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i><time datetime=2018-04-26T00:00:00Z>April 26, 2018</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>4-minute read</span></div></div></header><div><p>A script written at any time for the convenience of taking notes and/or removing white background and uploading images to the OSS service.</p><p>When I recently wrote notes, I encountered the problem of putting the handwritten/screen content on the paper on the webpage. This is a manual solution: scan the Evernote document, save it to the computer, download it on the computer, PS Remove the white background, upload it to OSS, get the image link, and insert it into the note. However, the whole process was too complicated and made me feel uncomfortable. I just tried to write a script. I originally thought about a full set of packages, but after discovering that the camera document scanning and the mobile computer file synchronization are really difficult to do, I still use Evernote. So what the script does is: you can take a screenshot, remove the white background (transparent color, optional function) from the document image, upload it to OSS, and copy the link address to the clipboard.</p><h2 id=screenshots>Screenshots</h2><p>Mainly used a ready-made python library on github, written in pyQt5, lightweight, easy to use. Modify it on the basis of the source code to use it.</p><p><a href=https://github.com/SeptemberHX/screenshot>https://github.com/SeptemberHX/screenshot</a></p><h2 id=oss-api>OSS API</h2><p>I first tried to upload it to Alibaba Cloud&rsquo;s OSS programmatically. I flipped through their API official documentation for a long time, and later found out that there is a ready-made Python SDK. Why not:)</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>pip install oss2
</code></pre></div><p>It can be installed. It is also very convenient to use, initialize with the permission ID and key, terminal name, etc., and then directly upload a file object. A file prefix is ​​specifically set for the automatic upload script. However, the OSS structure that was originally used to make the picture bed is also quite messy.</p><p>After the upload is complete, use python&rsquo;s cross-platform clipboard package <code>pyperclipto</code> copy the address to the clipboard.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> pyperclip

pyperclip<span style=color:#f92672>.</span>copy(address)
</code></pre></div><p>Then the infrastructure is complete.</p><h2 id=remove-the-white-background>Remove the white background</h2><p>The more troublesome thing is that the background is transparent, because it is ugly to put a white background image on a web page of another color. The background of the photos in the Evernote scan mode is basically very white. Before you select the color directly in the PS (the tolerance is not large), delete it. This step can still be implemented programmatically.</p><p>Python&rsquo;s image processing library: PIL (Python Image Library). Step: Read in the file, convert to RGBA mode, traverse the pixel, if it is white, set the alpha channel to 0 and save. Code:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>from</span> PIL <span style=color:#f92672>import</span> Image

im <span style=color:#f92672>=</span> Image<span style=color:#f92672>.</span>open(filename)<span style=color:#f92672>.</span>convert(<span style=color:#e6db74>&#39;RGBA&#39;</span>)
pix <span style=color:#f92672>=</span> im<span style=color:#f92672>.</span>load()
<span style=color:#66d9ef>for</span> y <span style=color:#f92672>in</span> range(im<span style=color:#f92672>.</span>size[<span style=color:#ae81ff>1</span>]):
    <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(im<span style=color:#f92672>.</span>size[<span style=color:#ae81ff>0</span>]):
        <span style=color:#66d9ef>if</span> pix[x,y][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>220</span> <span style=color:#f92672>and</span> pix[x,y][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>220</span> <span style=color:#f92672>and</span> pix[x,y][<span style=color:#ae81ff>3</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>220</span>:
            pix[x,y] <span style=color:#f92672>=</span> (<span style=color:#ae81ff>255</span>,<span style=color:#ae81ff>255</span>,<span style=color:#ae81ff>255</span>,<span style=color:#ae81ff>0</span>)
filename <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>splitext(filename)[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;_rmbg.png&#39;</span>
im<span style=color:#f92672>.</span>save(filename, <span style=color:#e6db74>&#39;PNG&#39;</span>)
</code></pre></div><h2 id=configure-path>Configure Path</h2><p>This is basically done. In order to allow the script to be accessed in any path, create a new path D:\scripts\ and add it to the system Path so that the script inside can be executed directly. The python file and bat script in the directory, call python script by executing bat. Ossup.bat:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bat data-lang=bat>python D:\scripts\oss.py %1 %2
</code></pre></div><p>You&rsquo;re done.</p><p>Finally the full python file:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> os<span style=color:#f92672>,</span> sys<span style=color:#f92672>,</span> pyperclip
<span style=color:#f92672>import</span> oss2
<span style=color:#f92672>from</span> PIL <span style=color:#f92672>import</span> Image

<span style=color:#66d9ef>if</span> len(sys<span style=color:#f92672>.</span>argv) <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>2</span>:
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;No enough arguments!&#39;</span>)
    exit()

filename <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>basename(sys<span style=color:#f92672>.</span>argv[<span style=color:#ae81ff>1</span>])

<span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>exists(filename):
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;File not exists : &#39;</span> <span style=color:#f92672>+</span> filename)
    exit()

<span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;bg&#39;</span> <span style=color:#f92672>in</span> sys<span style=color:#f92672>.</span>argv:
    <span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Processing background...&#39;</span>)
    im <span style=color:#f92672>=</span> Image<span style=color:#f92672>.</span>open(filename)<span style=color:#f92672>.</span>convert(<span style=color:#e6db74>&#39;RGBA&#39;</span>)
    pix <span style=color:#f92672>=</span> im<span style=color:#f92672>.</span>load()
    <span style=color:#66d9ef>for</span> y <span style=color:#f92672>in</span> range(im<span style=color:#f92672>.</span>size[<span style=color:#ae81ff>1</span>]):
        <span style=color:#66d9ef>for</span> x <span style=color:#f92672>in</span> range(im<span style=color:#f92672>.</span>size[<span style=color:#ae81ff>0</span>]):
            <span style=color:#66d9ef>if</span> pix[x,y][<span style=color:#ae81ff>0</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>220</span> <span style=color:#f92672>and</span> pix[x,y][<span style=color:#ae81ff>2</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>220</span> <span style=color:#f92672>and</span> pix[x,y][<span style=color:#ae81ff>3</span>] <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>220</span>:
                pix[x,y] <span style=color:#f92672>=</span> (<span style=color:#ae81ff>255</span>,<span style=color:#ae81ff>255</span>,<span style=color:#ae81ff>255</span>,<span style=color:#ae81ff>0</span>)
    filename <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>path<span style=color:#f92672>.</span>splitext(filename)[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;_rmbg.png&#39;</span>
    im<span style=color:#f92672>.</span>save(filename, <span style=color:#e6db74>&#39;PNG&#39;</span>)

<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Initializing oss sdk...&#39;</span>)

access_key_id <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>getenv(<span style=color:#e6db74>&#39;OSS_TEST_ACCESS_KEY_ID&#39;</span>, <span style=color:#e6db74>&#39;&lt;&gt;&#39;</span>)
access_key_secret <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>getenv(<span style=color:#e6db74>&#39;OSS_TEST_ACCESS_KEY_SECRET&#39;</span>, <span style=color:#e6db74>&#39;&lt;&gt;&#39;</span>)
bucket_name <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>getenv(<span style=color:#e6db74>&#39;OSS_TEST_BUCKET&#39;</span>, <span style=color:#e6db74>&#39;&lt;&gt;&#39;</span>)
endpoint <span style=color:#f92672>=</span> os<span style=color:#f92672>.</span>getenv(<span style=color:#e6db74>&#39;OSS_TEST_ENDPOINT&#39;</span>, <span style=color:#e6db74>&#39;&lt;&gt;&#39;</span>)

bucket <span style=color:#f92672>=</span> oss2<span style=color:#f92672>.</span>Bucket(oss2<span style=color:#f92672>.</span>Auth(access_key_id, access_key_secret), endpoint, bucket_name)

oss_name <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;autoup/&#39;</span> <span style=color:#f92672>+</span> filename

<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Filename : &#39;</span> <span style=color:#f92672>+</span> oss_name <span style=color:#f92672>+</span> <span style=color:#e6db74>&#39;</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Uploading&#39;</span>)

<span style=color:#66d9ef>with</span> open(filename, <span style=color:#e6db74>&#39;rb&#39;</span>) <span style=color:#66d9ef>as</span> f:
    bucket<span style=color:#f92672>.</span>put_object(oss_name, f)

<span style=color:#66d9ef>if</span> <span style=color:#e6db74>&#39;bg&#39;</span> <span style=color:#f92672>in</span> sys<span style=color:#f92672>.</span>argv:
    os<span style=color:#f92672>.</span>remove(filename)

address <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&lt;&gt;&#39;</span> <span style=color:#f92672>+</span> oss_name
pyperclip<span style=color:#f92672>.</span>copy(address)

<span style=color:#66d9ef>print</span>(<span style=color:#e6db74>&#39;Address copied to clipboard!</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>Bye~&#39;</span>)
</code></pre></div></div><footer></footer></article><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};</script></section></div><footer class=footer><section class=container><p>© 2016 - 2023 Sine Liu</p></section></footer></main><script src=https://ssine.ink/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-127064931-1','auto');ga('send','pageview');}</script></body></html>