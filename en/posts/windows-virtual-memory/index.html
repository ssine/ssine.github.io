<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=content-language content="en"><meta name=author content="Sine"><meta name=description content="Note: This passage is mainly translated by Google translator, please turn to the Chinese version for more accurate expression if possible. Virtual memory provides a logical view of memory, it does not correspond to the layout of physical memory. During operation, the memory manager maps virtual addresses to physical addresses with the help of hardware support. Each process has its own virtual address space, and it will feel that it"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content="Windows Virtual Memory Intro"><meta name=twitter:description content="Note: This passage is mainly translated by Google translator, please turn to the Chinese version for more accurate expression if possible. Virtual memory provides a logical view of memory, it does not correspond to the layout of physical memory. During operation, the memory manager maps virtual addresses to physical addresses with the help of hardware support. Each process has its own virtual address space, and it will feel that it"><meta property="og:title" content="Windows Virtual Memory Intro"><meta property="og:description" content="Note: This passage is mainly translated by Google translator, please turn to the Chinese version for more accurate expression if possible. Virtual memory provides a logical view of memory, it does not correspond to the layout of physical memory. During operation, the memory manager maps virtual addresses to physical addresses with the help of hardware support. Each process has its own virtual address space, and it will feel that it"><meta property="og:type" content="article"><meta property="og:url" content="https://ssine.ink/en/posts/windows-virtual-memory/"><meta property="article:published_time" content="2018-06-13T00:00:00+00:00"><meta property="article:modified_time" content="2018-06-13T00:00:00+00:00"><title>Windows Virtual Memory Intro · Sine's Site</title><link rel=canonical href=https://ssine.ink/en/posts/windows-virtual-memory/><link rel=preconnect href=https://fonts.gstatic.com><link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel=stylesheet><link rel=preload href="https://ssine.ink/fonts/forkawesome-webfont.woff2?v=1.1.7" as=font type=font/woff2 crossorigin><link rel=stylesheet href=https://ssine.ink/css/coder.min.a050bb9724f6a498b574acf612d6d523bc68756ddc62579923710a8542947c52.css integrity="sha256-oFC7lyT2pJi1dKz2EtbVI7xodW3cYleZI3EKhUKUfFI=" crossorigin=anonymous media=screen><link rel=stylesheet href=https://ssine.ink/css/coder-dark.min.126ad3988d46bdae6217a11105b53c9662bca05f39d42d3c0fb366919d334620.css integrity="sha256-EmrTmI1Gva5iF6ERBbU8lmK8oF851C08D7NmkZ0zRiA=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=https://ssine.ink/favicon.ico sizes=32x32><link rel=icon type=image/png href=https://ssine.ink/favicon.ico sizes=16x16><link rel=apple-touch-icon href=https://ssine.ink/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=https://ssine.ink/images/apple-touch-icon.png><meta name=generator content="Hugo 0.74.1"></head><body class=colorscheme-auto><div class=float-container><a id=dark-mode-toggle class=colorscheme-toggle><i class="fa fa-adjust fa-fw" aria-hidden=true></i></a></div><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=https://ssine.ink/en>Sine's Site</a>
<input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=https://ssine.ink/en/posts/>Blog</a></li><li class=navigation-item><a class=navigation-link href=https://kiwi.ssine.cc>Wiki</a></li><li class=navigation-item><a class=navigation-link href=https://ssine.ink/en/gallery>Gallery</a></li><li class=navigation-item><a class=navigation-link href=https://ssine.ink/en/projects/>Projects</a></li><li class="navigation-item menu-separator"><span>|</span></li><li class=navigation-item><a href=https://ssine.ink/posts/windows-virtual-memory/>中文</a></li></ul></section></nav><div class=content><section class="container post"><article><header><div class=post-title><h1 class=title>Windows Virtual Memory Intro</h1></div><div class=post-meta><div class=date><span class=posted-on><i class="fa fa-calendar" aria-hidden=true></i><time datetime=2018-06-13T00:00:00Z>June 13, 2018</time></span>
<span class=reading-time><i class="fa fa-clock-o" aria-hidden=true></i>One-minute read</span></div><div class=categories><i class="fa fa-folder" aria-hidden=true></i><a href=https://ssine.ink/en/categories/%E8%AF%BE%E7%A8%8B/>课程</a></div><div class=tags><i class="fa fa-tag" aria-hidden=true></i><a href=https://ssine.ink/en/tags/windows/>windows</a>
<span class=separator>•</span>
<a href=https://ssine.ink/en/tags/%E8%AF%BE%E7%A8%8B/>课程</a></div></div></header><div><p><strong>Note: This passage is mainly translated by Google translator, please turn to the Chinese version for more accurate expression if possible.</strong></p><p>Virtual memory provides a logical view of memory, it does not correspond to the layout of physical memory. During operation, the memory manager maps virtual addresses to physical addresses with the help of hardware support.</p><p>Each process has its own virtual address space, and it will feel that it monopolizes this large address space. In a 32-bit x86 system, the total virtual address space is 4GB. Because the 32-bit pointer can represent the value between 0X00000000 and 0XFFFFFFFF. But by default, Windows will give 2GB of address space to the process as its private address space, called user mode space; while the other half (the higher half of the address space, from 0X80000000 to 0XFFFFFFFF) is used as its own The protected kernel usage is called kernel mode space.</p><p>Virtual memory has three benefits:</p><ul><li>Programs can use a series of adjacent virtual addresses to access non-adjacent memory blocks in physical memory.</li><li>The program can access memory buffers that are larger than the available physical memory. When the supply of physical memory becomes small, the memory manager saves physical memory pages (usually 4 KB in size) to disk files. Pages are swapped in and out between physical memory and disk as needed.</li><li>The virtual addresses used by different processes are isolated from each other. Code in one process cannot access the physical memory being used by another process.</li></ul><p>There are three ways for applications to use memory:</p><ol><li>The virtual memory allocation method based on pages is suitable for large objects or structure arrays;</li><li>Memory mapping file method, suitable for large data stream files and data sharing between multiple processes;</li><li>The memory heap method is suitable for a large number of small memory applications.</li></ol><p>There are a series of Win32 APIs that can be used for memory-related allocation, use, and query operations. For details, you can query Microsoft&rsquo;s documentation. The following mainly introduces the first type of method.</p><p>Pages in the virtual address space of a Windows process have three states: free, reserved, and committed. The process can also lock and unlock a page, and the locked memory will have a high probability of being retained in the physical memory (not guaranteed). The relationship between the states is as follows:</p><p><img src=OS-virtual-memory-states.svg alt="Win32 memory"></p><p>Windows can set the type of protection for memory. Several examples used in the experiment are listed below:</p><table><thead><tr><th>Macro Definition</th><th>Type</th></tr></thead><tbody><tr><td>PAGE_READONLY</td><td>read only</td></tr><tr><td>PAGE_READWRITE</td><td>Read and Write</td></tr><tr><td>PAGE_EXECUTE</td><td>Execute</td></tr><tr><td>PAGE_EXECUTE_READ</td><td>write+execute</td></tr><tr><td>PAGE_EXECUTE_READWRITE</td><td>Read and Write+Execute</td></tr></tbody></table><p>Performing operations outside the authority on a page will cause an error.</p></div><footer></footer></article><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>MathJax={tex:{inlineMath:[['$','$'],['\\(','\\)']],processEscapes:true,processEnvironments:true},options:{skipHtmlTags:['script','noscript','style','textarea','pre']}};</script></section></div><footer class=footer><section class=container><p>© 2016 - 2023 Sine Liu</p></section></footer></main><script src=https://ssine.ink/js/dark-mode.min.0213e1773e6d1c5a644f847c67a6f8abac49a3776e2976f6008038af8c5b76a1.js></script><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-127064931-1','auto');ga('send','pageview');}</script></body></html>